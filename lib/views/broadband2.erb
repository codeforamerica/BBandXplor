<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
		<title>Allegheny County Broadband</title>
		<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript">
var map, infoWindow, markers, providers, checkdiv;
function init(){

	var ctr = new google.maps.LatLng(40.429178,-79.980469);
	var z = 12;
	if(gup("lat")){
		ctr = new google.maps.LatLng(1 * gup("lat"), 1 * gup("lng"));
		z = 1 * gup("z");
	}
	var mapOptions = {
		center: ctr,
		zoom: z,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	};
	map = new google.maps.Map($("map_canvas"), mapOptions);

	infoWindow = new google.maps.InfoWindow({ maxWidth: 350 });
	google.maps.event.addListener(map, 'click', function() {
		infoWindow.close();
	});
	
	google.maps.event.addListener(map, 'bounds_changed', function() {
		updatePerma();
	});
	
	providers = [
		{id:"arm",url:"Armstrong.kmz"},
		{id:"cog",url:"Cogent.kmz"},
		{id:"com",url:"Comcast.kmz"},
		{id:"con",url:"Consolidated.kmz"},
		{id:"cov",url:"Covad.kmz"},
		{id:"fib",url:"Fibertech.kmz"},
		{id:"lev",url:"Level3.kmz"},
		{id:"one",url:"OneComm.kmz"},
		{id:"pae",url:"Paetec.kmz"},
		{id:"sti",url:"Sting.kmz"},
		{id:"win",url:"Windstream.kmz"},
		{id:"xoc",url:"XOcomm.kmz"},
		{id:"holes",url:"ispholes.kmz"}
	];
	
	for(var p=0;p<providers.length;p++){
		providers[p].layer = new google.maps.KmlLayer('http://bbandxplor.herokuapp.com/' + providers[p].url, { suppressInfoWindows: true, preserveViewport: true });
		if(gup("lyrs")){
			if(gup("lyrs").indexOf(providers[p].id) > -1){
				$(providers[p].id).innerHTML = '&check;' + $(providers[p].id).innerHTML;
				providers[p].layer.setMap(map);
			}
		}
	}
	
	checkdiv = document.createElement("div");
	checkdiv.innerHTML = "&check;";
}
function bindWindow(mapmrk, datamrk){
	google.maps.event.addListener(mapmrk, 'click', function() {
		infoWindow.setContent("<h3>" + datamrk.name + "</h3>" + datamrk.details + "<hr/><a href='" + datamrk.link + "' target='_blank'>" + datamrk.link + "</a>");
		infoWindow.open(map, mapmrk);
	});
}
function toggle(btn){
	var setLayerOn = map;
	if(btn.innerHTML.indexOf(checkdiv.innerHTML) > -1){
		setLayerOn = null;
		btn.innerHTML = btn.innerHTML.replace(checkdiv.innerHTML,'');
	}
	else{
		btn.innerHTML = '&check;' + btn.innerHTML;
	}
	for(var p=0;p<providers.length;p++){
		if(providers[p].id == btn.id){
			providers[p].layer.setMap(setLayerOn);
			break;
		}
	}
	updatePerma();
}
function updatePerma(){
	var lat = map.getCenter().lat();
	var lng = map.getCenter().lng();
	var zoom = map.getZoom();
	var lyrs = [ ];
	for(var p=0;p<providers.length;p++){
		if(providers[p].layer.getMap()){
			lyrs.push(providers[p].id);
		}
	}
	$("perma").href = "http://bbandxplor.herokuapp.com/broadband2?lat=" + lat + "&lng=" + lng + "&z=" + zoom + "&lyrs=" + lyrs.join(',');
}
function gup(nm){nm=nm.replace(/[\[]/,"\[").replace(/[\]]/,"\]");var rxS="[\?&]"+nm+"=([^&#]*)";var rx=new RegExp(rxS);var rs=rx.exec(window.location.href);if(!rs){return null;}else{return rs[1];}}
function $(id){
	return document.getElementById(id);
}
		</script>
		<style type="text/css">
html, body {
	height: 100%;
	width: 100%;
	margin: 0;
	padding: 0;
	font-family: georgia, arial, serif;
}
#sidebar {
	float: left;
	width: 19%;
	height: 100%;
}
#map_canvas {
	float: left;
	width: 80%;
	height: 100%;
}
		</style>
	</head>
	<body onload="init()">
		<div id="sidebar">
			<h3>Terrestrial</h3>
			<ul>
				<li>
					<a id="arm" href="#" class="btn" onclick="toggle(this)">Armstrong</a>
				</li>
				<li>
					<a id="cog" href="#" class="btn" onclick="toggle(this)">Cogent</a>				
				</li>
				<li>
					<a id="com" href="#" class="btn" onclick="toggle(this)">Comcast</a>
				</li>
				<li>
					<a id="con" href="#" class="btn" onclick="toggle(this)">Consolidated</a>
				</li>
				<li>
					<a id="cov" href="#" class="btn" onclick="toggle(this)">Covad</a>
				</li>
				<li>
					<a id="fib" href="#" class="btn" onclick="toggle(this)">Fibertech</a>
				</li>
				<li>
					<a id="lev" href="#" class="btn" onclick="toggle(this)">Level 3</a>
				</li>
				<li>
					<a id="one" href="#" class="btn" onclick="toggle(this)">One Comm.</a>
				</li>
				<li>
					<a id="pae" href="#" class="btn" onclick="toggle(this)">Paetec</a>
				</li>
				<li>
					<a id="sti" href="#" class="btn" onclick="toggle(this)">Sting</a>
				</li>
				<li>
					<a id="win" href="#" class="btn" onclick="toggle(this)">Windstream</a>
				</li>
				<li>
					<a id="xoc" href="#" class="btn" onclick="toggle(this)">XO Comm.</a>
				</li>
			</ul>
			<h3>Wireless</h3>
			<ul>
				<li>
					Work in Progress
				</li>
			</ul>
			<h3>Holes File</h3>
			<ul>
				<li>
					<a id="holes" href="#" class="btn" onclick="toggle(this)">Holes</a>
				</li>
			</ul>
			<hr/>
			<a id="perma" href="http://bbandxplor.herokuapp.com/broadband">Link to this View</a>
			<br/>
			<small>Data from <a href="http://www.broadbandmap.gov/summarize/state/georgia/county/bibb">BroadbandMap.gov</a><br/>
			US Dept of Commerce, NTIA, State Broadband Initiative (Jun 2011)</small>
		</div>
		<div id="map_canvas">
		</div>
	</body>
</html>